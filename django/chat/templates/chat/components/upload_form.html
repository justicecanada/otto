
<form id="chat-upload-form"
      method="post"
      enctype="multipart/form-data"
      hx-post="{% url 'chat:upload' chat.id %}"
      hx-swap="beforeend"
      hx-target="#messages-container"
      hx-encoding="multipart/form-data">
  {% csrf_token %}
  {{ upload_form }}
  {% for hidden in upload_form.hidden_fields %}{{ hidden }}{% endfor %}
  <input type="submit" value="Save" id="chat-upload-submit" />
</form>

<script>
function submitUploadsIfComplete() {
  const form = document.getElementById("chat-upload-form");
  const allSuccess = Array.from(form.querySelectorAll(".dff-file")).every(file => {
    return file.classList.contains("dff-upload-success");
  });
  if (allSuccess) {
    form.dispatchEvent(new Event('submit'));
  }
}
initUploadFields(document.getElementById("chat-upload-form"), {
  supportDropArea: false,
  callbacks: {
    onSuccess: (upload) => submitUploadsIfComplete(),
  }
});
</script>
