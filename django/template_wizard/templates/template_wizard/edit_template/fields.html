{% load i18n %}

<div class="mb-3">
  <label for="fields-listbox" class="form-label">{% trans "Fields" %}</label>
  <ul class="list-group" id="fields-listbox">
    {% for field in template.fields.all %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>{{ field.field_name }} ({{ field.field_type }})</span>
        <span>
          <button type="button"
                  class="btn btn-sm btn-outline-primary me-2"
                  data-bs-toggle="modal"
                  data-bs-target="#fieldModal"
                  hx-get="{% url 'template_wizard:field_modal' template_id=template.id field_id=field.id %}"
                  hx-target="#fieldModal .modal-content"
                  hx-swap="innerHTML"
                  onclick="document.querySelector('#fieldModal .modal-content').innerHTML = ''">
            {% trans "Edit" %}
          </button>
          <a class="btn btn-sm btn-outline-danger"
             href="{% url 'template_wizard:delete_field' template_id=template.id field_id=field.id %}"
             onclick="return confirm('{% trans 'Are you sure you want to delete this field?' %}');">{% trans "Delete" %}</a>
        </span>
      </li>
    {% empty %}
      <li class="list-group-item text-muted">{% trans "No fields defined yet." %}</li>
    {% endfor %}
  </ul>
</div>
<div class="mb-3">
  <button type="button"
          class="btn btn-primary"
          data-bs-toggle="modal"
          data-bs-target="#fieldModal"
          hx-get="{% url 'template_wizard:field_modal' template_id=template.id %}"
          hx-target="#fieldModal .modal-content"
          hx-swap="innerHTML"
          onclick="document.querySelector('#fieldModal .modal-content').innerHTML = ''">
    {% trans "Add Field" %}
  </button>
  {% if template.fields.all %}
    <button type="button"
            class="btn btn-outline-success"
            hx-get="{% url 'template_wizard:test_fields' template_id=template.id %}"
            hx-target="#test-fields"
            hx-swap="innerHTML"
            hx-indicator="#test-fields-spinner">{% trans "Test field extraction on example source" %}</button>
    <div class="d-inline-block ms-2">
      <div id="test-fields-spinner" class="spinner container text-primary">
        <span class="spinner-border" aria-hidden="true"></span>
        <span class="visually-hidden" role="status">{% trans "Loading" %}</span>
      </div>
    </div>
  {% endif %}
</div>
<div id="test-fields"></div>

<!-- Modal -->
<div class="modal fade"
     id="fieldModal"
     tabindex="-1"
     aria-labelledby="fieldModalLabel"
     aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal content loaded here by HTMX -->
    </div>
  </div>
</div>

<div class="row mt-3">
  <div class="col text-end">
    <a class="btn btn-primary"
       href="{% url 'template_wizard:edit_layout' template.id %}">
      {% trans "Next" %}<i class="bi bi-chevron-right ms-2"></i>
    </a>
  </div>
</div>
