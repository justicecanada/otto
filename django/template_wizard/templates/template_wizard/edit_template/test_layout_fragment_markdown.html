{% if test_results.error %}
  <div class="alert alert-danger">{{ test_results.error }}</div>
{% else %}
  <div class="rendered-markdown card p-3" id="rendered-markdown"></div>
  <script type="application/json" id="raw-markdown">{{ test_results.output_markdown|escapejs }}</script>
  <script>
    (function() {
      // Get the raw markdown from the script tag
      var rawMarkdown = document.getElementById('raw-markdown').textContent;
      // Unescape if needed (escapejs ensures it's valid JSON string)
      try {
        rawMarkdown = JSON.parse('"' + rawMarkdown + '"');
      } catch (e) {}
      // Render with markdown-it (assumes markdownit is loaded globally)
      if (window.markdownit) {
        var md = window.markdownit({breaks: true});
        document.querySelector('.rendered-markdown').innerHTML = md.render(rawMarkdown);
      } else {
        document.querySelector('.rendered-markdown').innerHTML = '<pre>' + rawMarkdown + '</pre>';
      }
    })();
  </script>
{% endif %}
