{% load i18n %}

<div class="row">
  <div class="col">
    <h3 class="h5 mb-4 mx-3" style="font-style:italic;">{{ query }}</h3>
  </div>
  <div class="col-auto" id="show-answer-button-container">
    <button class="btn btn-link text-decoration-none text-body px-2 d-none"
            type="button"
            id="show-answer-button"
            onclick="showAnswer();">
      <i class="bi bi-eye"></i>
      {% trans "Show AI answer" %}
    </button>
    {% if disable_llm %}
      <button class="btn btn-link text-decoration-none text-body px-2"
              type="button"
              id="get-answer-button"
              hx-get="{% url 'laws:get_answer_column' query_uuid %}"
              hx-target="#answer-column-placeholder"
              hx-swap="outerHTML">
        <i class="bi bi-robot"></i>
        {% trans "Get AI answer" %}
      </button>
    {% endif %}
  </div>
</div>
<div class="row" id="search-result-row">
  {% if not disable_llm %}
    {% include "laws/_answer_column.html" %}
  {% else %}
    <div id="answer-column-placeholder" class="d-none"></div>
  {% endif %}
  <div class="col">
    {% if error %}
      <div class="alert alert-danger">
        <p>{% trans "Error getting search results:" %}</p>
        <p>{{ error }}</p>
      </div>
    {% elif not sources|length %}
      <div class="alert alert-warning">
        {% trans "No sources found. Please modify the search options or use basic search." %}
      </div>
    {% else %}
      <div id="sources-container" class="row">
        <div class="col">
          {% for source in sources %}
            <!-- Bootstrap card -->
            <div class="card source mb-2" id="{{ source.node_id }}">
              <div class="card-body pb-1">
                <div class="row">
                  <div class="col">
                    <h4 class="h5 card-title">
                      {{ source.title }}
                      {% if source.chunk %}
                        ({% trans "Part" %} {{ source.chunk }})
                      {% endif %}
                    </h4>
                    {% if source.headings %}
                      <p class="h6 card-subtitle mb-2 text-muted fw-normal">
                        <em>{{ source.headings }}</em>
                      </p>
                    {% endif %}
                  </div>
                  <div class="col-auto">
                    <button class="btn btn-link text-decoration-none text-body px-2"
                            onclick="showSourceDetails(this);"
                            hx-get="{% url 'laws:source' source.node_id %}"
                            hx-target="#source-details-inner"
                            hx-indicator="#source-details-spinner">
                      <i class="bi bi-three-dots-vertical"></i>
                      <span class="visually-hidden">{% trans "Details" %}</span>
                    </button>
                  </div>
                </div>
                <div class="card-text">{{ source.html|safe }}</div>
              </div>
            </div>
          {% endfor %}
        </div>
        <div id="source-details" class="col-sm-6 d-none ps-0">
          <div id="source-details-spinner"
               class="spinner container text-primary px-4 pt-3">
            <span class="spinner-border" aria-hidden="true"></span>
            <span class="visually-hidden" role="status">Loading...</span>
          </div>
          <div id="source-details-inner"></div>
        </div>
      </div>
    {% endif %}
  </div>
</div>
