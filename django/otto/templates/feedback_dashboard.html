{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block breadcrumb %}
  {{ block.super }}
  <li class="breadcrumb-item">
    <a href="{% url 'manage_users' %}">{% trans "Manage users" %}</a>
  </li>
  <li class="breadcrumb-item">
    <a href="{% url 'feedback_dashboard' %}">{% trans "Feedback dashboard" %}</a>
  </li>
{% endblock %}

{% block page_css %}
  <style>

  .badge {    
    line-height: 16px !important;
    font-weight: 600;

    &.badge-neutral {
      background-color: hsl(210, 20%, 98%);
      border-color: rgb(229, 231, 235) !important;
      color: rgb(75, 85, 99);
    }
    &.badge-completed {
      background-color: hsl(138, 76%, 97%);
      border-color: hsl(142, 49%, 85%) !important;
      color: hsl(142, 72%, 29%);      
    }
  }
  .feedback-message{
    overflow: hidden;    
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  .active {
    border-left: 4px solid var(--app-color-purple-1);
  }  

  tbody tr:nth-last-child(3){
    border-bottom-width: 0 !important;

    td {
      border-bottom-width: 0 !important;
    }
  }

  </style>
{% endblock %}

{% block page_title %}
  {% trans "Feedback dashboard - Otto" %}
{% endblock %}

{% block content_container %}
  <div>
    <div class="container py-3 px-0">
      <h1 class="mb-3 mt-2 fs-2">{% trans "Feedback dashboard" %}</h1>

      {% include 'components/feedback/feedback_stats.html' %}

 
      <div class="row mt-3 border rounded g-0 pt-3">
        <h2 class="mb-3 fs-5 ps-2 fw-semibold" style="letter-spacing: -0.025em">{% trans "Latest feedback" %}</h2>
        <p class="mb-3 ps-2 text-muted">
          {% trans "Click on a row to view more information about the feedback received, to flag the feedback as \"addressed\" or to contact the user directly." %}
        </p>
        <div class="table-responsive">
          <table class="table mb-0" id="feedback-table">
            <thead>
              <tr>
                <th class="col-2">{% trans "Application" %}</th>
                <th class="col-8">{% trans "Message" %}</th>
                <th class="col-2"></th>
              </tr>
            </thead>
            <tbody>
              {% for info in feedback_info %}
                <tr data-bs-toggle="collapse"
                    data-bs-target="#collapse-{{ info.feedback.id }}"
                    aria-expanded="false"
                    aria-controls="collapse-{{ info.feedback.id }}"
                    onclick="this.classList.toggle('active')"
                    class="feedback-summary px-2 py-4"
                    style="cursor: pointer">
                  <td class="align-middle text-start col-2">
                    <div class="d-flex flex-column justify-content-center gap-1">
                      <span class="fw-semibold align-middle">{{ info.feedback.app|upper }}</span>
                      <span class="text-muted" style="font-size: .85rem;">{{ info.feedback.created_at|timesince }} ago</span>
                    </div>
                  </td>

                  <td class="align-middle col-8">
                    <span class="feedback-message">Lorem ipsum dolor, sit amet consectetur adipisicing elit. Alias, pariatur velit animi incidunt adipisci quam. Vero cupiditate libero quasi deleniti impedit, quas quo non deserunt ad incidunt? Beatae, non molestias. Lorem ipsum dolor sit amet consectetur adipisicing elit. Maiores necessitatibus perferendis molestiae quas, molestias esse modi facere id accusantium ipsum explicabo debitis! Totam, iste laboriosam sunt dolore in quidem veritatis.</span>
                  </td>
                  <td class="align-middle text-end col-2">
                    <div class="d-flex flex-column justify-content-center align-items-end gap-1">
                      <div class="badge badge-completed w-50 border">Completed</div>

                    </div>
                  </td>
                </tr>
                {% include 'components/feedback/feedback_details.html' with feedback=info.feedback form=info.form %}
              {% endfor %}
 
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block page_script %}{% endblock %}
