{% load i18n %}

<div class="card mb-4">
  <div class="card-header">
    <h5 class="card-title">{% trans "Filters" %}</h5>
  </div>
  <div class="card-body">
    <div class="row g-3" id="filter-form">
      <div class="col-md-6">
        <label for="status" class="form-label">{% trans "Status" %}</label>
        <select name="status" id="status" class="form-select">
          <option value="">{% trans "All statuses" %}</option>
          {% for status in statuses %}
            <option value="{{ status }}"
                    {% if status_filter == status %}selected{% endif %}>{{ status }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-6">
        <label for="task_name" class="form-label">{% trans "Task Name" %}</label>
        <select name="task_name" id="task_name" class="form-select">
          <option value="">{% trans "All tasks" %}</option>
          {% for task_name in task_names %}
            <option value="{{ task_name }}"
                    {% if task_name_filter == task_name %}selected{% endif %}>{{ task_name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-12">
        <a href="#" class="btn btn-outline-secondary" id="reset-filters">{% trans "Reset" %}</a>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const statusSelect = document.getElementById('status');
  const taskNameSelect = document.getElementById('task_name');
  const resetBtn = document.getElementById('reset-filters');
  
  const table = document.getElementById('task-table');

  function filterTable() {
    const status = statusSelect.value;
    const taskName = taskNameSelect.value;
    if (!table) return;
    const rows = table.querySelectorAll('tbody tr');
    rows.forEach(row => {
      const rowStatus = row.getAttribute('data-status');
      const rowTaskName = row.getAttribute('data-task-name');
      let show = true;
      if (status && rowStatus !== status) show = false;
      if (taskName && rowTaskName !== taskName) show = false;
      row.style.display = show ? '' : 'none';
    });
  }

  statusSelect.addEventListener('change', filterTable);
  taskNameSelect.addEventListener('change', filterTable);

  resetBtn.addEventListener('click', function(e) {
    e.preventDefault();
    statusSelect.value = '';
    taskNameSelect.value = '';
    filterTable();
  });

  // Initial filter on page load
  filterTable();
});
</script>
